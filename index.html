<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Firebase App (obligatoire) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    
    <!-- Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <meta charset="UTF-8">
    <title>Killer Party</title>

    <!-- Important pour le mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f5f5f5;
            font-family: Arial, sans-serif;
        }

        .container {
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        button {
            font-size: 1.2rem;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            background: #007bff;
            color: white;
            cursor: pointer;
            transition: 0.2s;
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            background: #999;
            cursor: not-allowed;
        }

        /* Overlay plein écran */
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #overlay img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Killer Party</h1>
    <select id="prenom">
        <option value="">Choisir votre prénom</option>
        <option value="Angelo">Angelo</option>
        <option value="Vinciane">Vinciane</option>
        <option value="Coraline">Coraline</option>
        <option value="Jason">Jason</option>
        <option value="Kelly">Kelly</option>
        <option value="Nathan">Nathan</option>
    </select>
    <br><br>
    <button id="btn" disabled>Lancer le jeu</button>
</div>

<div id="overlay" onclick="fermerImage()">
    <img src="image.jpg" alt="Image plein écran">
</div>

<script>
    // --- Configuration Firebase ---
    const firebaseConfig = {
        apiKey: "AIzaSyDN8pOUrRGbpatuYRwLQqFPeRzWNJphgaw",
        authDomain: "page-synchrone.firebaseapp.com",
        projectId: "page-synchrone",
        storageBucket: "page-synchrone.firebasestorage.app",
        messagingSenderId: "227545744120",
        appId: "1:227545744120:web:c313a7c4a5c6c541d8f10d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const btn = document.getElementById("btn");
    const prenomSelect = document.getElementById("prenom");
    
    // Générer un ID aléatoire pour chaque visiteur
    const userId = 'user-' + Math.random().toString(36).substr(2, 9);
    const userRef = db.collection('participants').doc(userId);
    
    // --- Nettoyer les anciens visiteurs au chargement ---
    db.collection('participants').get().then(snapshot => {
        snapshot.forEach(doc => {
            doc.ref.delete();
        });
    });

    // --- Mettre à jour le prénom et prêt quand on choisit ---
    prenomSelect.addEventListener('change', () => {
        const prenom = prenomSelect.value;
        if (prenom) {
            userRef.set({
                prenom: prenom,
                pret: true
            });
        } else {
            userRef.set({
                prenom: "",
                pret: false
            });
        }
    });
    
    // --- Écoute en temps réel ---
    db.collection('participants').onSnapshot(snapshot => {
        let count = 0;
        const pris = [];
    
        snapshot.forEach(doc => {
            const data = doc.data();
            if (data.pret) count++;
            // Collecte des prénoms déjà pris (sauf le sien)
            if (data.pret && doc.id !== userId) {
                pris.push(data.prenom);
            }
        });
    
        // Activer le bouton seulement quand 3 participants prêts
        btn.disabled = count < 2;
    
        // Désactiver les options déjà prises
        const options = prenomSelect.querySelectorAll('option');
        options.forEach(opt => {
            if (pris.includes(opt.value)) {
                opt.disabled = true;
            } else {
                opt.disabled = false;
            }
        });
    });
    
     // --- Bouton pour afficher l'image ---
    btn.addEventListener('click', () => {
        document.getElementById("overlay").style.display = "flex";
    });

    function fermerImage() {
        document.getElementById("overlay").style.display = "none";
    }
</script>
</body>
</html>
